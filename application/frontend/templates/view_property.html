{% extends "servicefrontend_base.html" %}
{% include "global/map_includes.html" %}

{% block content %}

<main id="wrapper" role="main">
    <div id="content">
    {% include "inc_alpha_banner.html" %}
        <div class="inner-block">

            <div class="notification edit-mode">
                <h2 class="heading-medium">Edit mode</h2>
            </div>

            <div class="callout callout--summary">

                <h1 class="heading-large first-heading">
                    Official register of title <span class="title-flag">{{ title.title_number }}</span>
                </h1>

                <!--
                <p>
                    This register was last changed on <b>7 August 2013</b> at <b>16:46:28</b>
                </p>
                -->

                <div class="lede">

                    <div class="grid grid-1-3">

                        <div itemscope itemtype="http://schema.org/PostalAddress">
                            <span itemprop="streetAddress">
                                {{ title.property.address.address_line_1 }}<br>
                                {% if title.property.address.address_line_2 %}
                                    {{ title.property.address.address_line_2 }} <br>
                                {% endif %}
                                {% if title.property.address.address_line_3 %}
                                    {{ title.property.address.address_line_3 }}<br>
                                {% endif %}
                                {% if title.property.address.address_line_4 %}
                                    {{ title.property.address.address_line_4 }}<br>
                                 {% endif %}
                            </span>
                            <span itemprop="addressLocality">{{ title.property.address.city }}</span><br>
                            <span itemprop="postalCode">{{ title.property.address.postcode }}</span>
                        </div>

                    </div>

                    <figure class="grid grid-1-3">
                        {% if title.extent is defined %}
                        <div id="map" class="title-plan" style="width:300px; height:200px;">
                            <script type='text/javascript'>
                                var extentData = {{ title.extent | tojson}};
                                {% if title.easements %}
                                  <!-- This is only for sprint 4, just one easement allowed, left as an array for future enhancement -->
                                  var easementData = {{ title.easements[0].easement_geometry | tojson}};
                                {% else %}
                                  var easementData = null;
                                {% endif %}
                                var apiKey = "{{ apiKey }}";
                            </script>
                            <script src="{{asset_path}}/javascripts/map.js"></script>
                        </div>
                        {% endif %}
                    </figure>

                </div>

                <dl class="inline">
                    <dt>Registered owner(s)</dt>
                    <dd>
                        {% for proprietor in title.proprietors %}
                            {% if  proprietor.full_name %}
                                {% if not loop.first %}, {% endif %}
                                {{ proprietor.full_name }}
                                <span class='change edit-mode'>
                                    (<a href='{{request.path}}/edit/title.proprietor.{{loop.index}}'>change</a>)
                                </span>
                            {% endif %}
                        {% endfor %}
                    </dd>

                    <dt>Tenure</dt>
                    <dd>{{ title.property.tenure | capitalize }}</dd>

                    <dt>Quality of title</dt>
                    <dd>{{ title.property.class_of_title | capitalize }}</dd>

                    {% if title.payment.price_paid %}
                    <dt>Price paid</dt>
                    <dd>&pound; {{ title.payment.price_paid | currency }}</dd>
                    {% endif %}
                </dl>

            </div>

            {% if title.property.tenure == 'Leasehold' %}
                <h2 class="heading-large">Lease Details</h2>
                <div class="charges">
                    <dl class="inline">
                    {% for lease in title.leases %}
                        <dt>Lease Date</dt>
                        <dd id="leaseDate">{{ lease.lease_date | format_date_YMD }}</dd>
                        <dt>Term</dt>
                        <dd id="leaseTerm">{{ lease.lease_term }} years from {{ lease.lease_from | format_date_YMD }}</dd>

                        <dt>Parties</dt>
                        <dd id="parties">1. {{ lease.lessor_name }}
                            {% if lease.lessee_name %}
                                <br/>
                                2. {{ lease.lessee_name }}
                            {% endif %}
                        </dd>
                    </dl>
                    <h4>Clauses</h4>

                    {% if lease.lease_easements == True %}
                        <p id="easementClause">Unless otherwise mentioned the title includes any legal easements granted
                            by the registered lease(s) but is subject to any rights that it reserves,
                            so far as those easements and rights exist and benefit or
                            affect the registered land.
                        </p><br/>
                    {% endif %}

                    {% if lease.alienation_clause == True %}
                        <p id="alienationClause">There are excepted from the effect of registration all estates. rights,
                            interests, powers and remedies arising upon, or by reason of, any
                            dealing made in breach of the prohibition or restriction against
                            dealings therewith inter vivos contained in the Lease.
                        </p><br/>
                    {% endif %}

                    {% if lease.title_registered == True %}
                        <p id="titleRegisteredClause">The registered Lease is made pursuant to Part V of the Housing Act 1985
                            and the land has the benefit of and is subject to the easements and rights
                            specified in paragraph 2 of Schedule 6 of the said Act.</p><br/>
                    {% endif %}
                {% endfor %}

                </div>
            {% endif %}

            {% if title.charges %}
            <h2 class="heading-large">Charges Register</h2>
            <div class="charges">
              <h3>This register contains any charges and other matters that affect the land.</h3>
              <ul>
                   {% for charge in title.charges %}
                  <li>Registered charge dated {{ charge.charge_date | format_date_YMD }}.<br>
                  Proprietor: {{ charge.chargee_name }}
                  (Co. Regn. No. {{ charge.chargee_registration_number }})
                  of {{ charge.chargee_address }}.</li>
                  {% endfor %}
              </ul>
            </div>
            {% endif %}

            {% if title.easements %}
            <h2 class="heading-large">Easements Register</h2>
            <div class="charges">
              <h3>This register contains any easements and other matters that affect the land.</h3>
              <ul>
                   {% for easement in title.easements %}
                  <li>{{ easement.easement_description }}</li>
                  {% endfor %}
              </ul>
            </div>
            {% endif %}

            <div class="divider">
                <button class='button' id='makeChange'>Edit the register</button>
            </div>
        </div><!-- end inner-block -->
    </div><!-- end content -->

    <script>
        $(document).ready(function() {
            var $editMode = $('.edit-mode');
            $editMode.hide();
            $('#makeChange').click(function() {
                $editMode.show();
                $('html, body').animate({ scrollTop: 0 }, 0);
            });
        });
    </script>
</main>

{% endblock %}
